<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="../../../doc/showcases.css">
<title>Visualizing Packet Drops</title>
</head>

<body>

<h1><center>Visualizing Packet Drops</center></h1>

<h2>Goals</h2>

<p>
Several network problems manifest themselves as excessive packet drops,
for example poor connectivity, congestion, or misconfiguration.
Poor connectivity in a wireless network can cause senders to drop unacknowledged packets after the retry limit is exceeded.
Congestion can cause queues to overflow in a bottleneck router, again resulting in packet drops. 
Visualizing packet drops helps identifying such problems in simulations,
thereby reducing time spent on debugging and analysis.
</p>

<p>
This example contains several simulation models demonstrating typical causes of packet drops.
</p>

<p>
INET version: <var>3.6</var><br>
Source files location: <var>inet/showcases/visualization/packetdrop</var>
</p>

<h2>About the visualizer</h2>

<p>
Packet drops can be visualized by including a <var>PacketDropVisualizer</var> module in the simulation.
The <var>PacketDropVisualizer</var> module indicates packet drops by displaying an animation effect at the node
where the packet drop occurs. In the animation, a packet icon gets thrown out from the node icon, and fades away.
</p>

<p>
The visualization of packet drops can be enabled with the visualizer's <var>displayPacketDrops</var> parameter.
By default, packet drops at all nodes are visualized. This selection can be narrowed with the
<var>nodeFilter</var>, <var>interfaceFilter</var> and <var>packetFilter</var> parameters.
</p>

<p>
One can click on the packet drop icon to display information about the packet drop in the inspector panel.
</p>

<p>
Packets are dropped for the following reasons:
</p>

<ul>
<li>queue overflow</li>
<li>retry limit exceeded</li>
<li>unroutable packet</li>
<li>network address resolution failed</li>
<!--li>packet lifetime expired</li-->
<li>interface down</li>
<!--li>fragmentation reassebly failed</li-->
<!--li>duplicate packet</li-->
<!--li>incorrect checksum</li-->
<!--li>frame not addressed to receiver</li-->
</ul>

<!--
TODO:
The color of the icon indicates the reason for the packet drop
-->

<h2>Queue overflow</h2>

<p>
In this section we present an example for demonstrating packet drops due to queue overflow.
This simulation can be run by choosing the QueueFull configuration from the ini file.
The network contains a bottleneck link where packets will be dropped due to an overflowing queue:
</p>

<img class="screen" src="queuefullnetwork.png">

<p>
It contains a <var>StandardHost</var> named <var>source</var>, an <var>EtherSwitch</var>, a <var>Router</var>, an <var>AccessPoint</var>, and a <var>WirelessHost</var> named <var>destination</var>.
The <var>source</var> is configured to send
a stream of UDP packets to <var>destination</var>. The packet stream starts at two seconds, after <var>destination</var> got associated with the access point.
The <var>source</var> is connected to the <var>etherSwitch</var> via a high speed, 100 Gbit/s ethernet cable,
while the <var>etherSwitch</var> and the <var>router</var> is connected with a low speed, 10 MBit/s cable.
This creates a bottleneck in the network, between the switch and the router. The source host is configured to generate more
UDP traffic than the 10Mbit/s channel can carry.
The cause of packet drops in this case is that the queue in <var>etherSwitch</var> fills up.
</p>

<p>
The queue types in the switch's ethernet interfaces are set to <var>DropTailQueue</var>, with a default length of 100 packets (by default, the queues have infinite lengths). The packets are dropped at the ethernet queue of the switch.
</p>

<p>
The visualization is activated with the <var>displayPacketDrops</var> parameter. The fade out time is set to three seconds, so that the packet
drop animation is more visible:
</p>

<pre class="snippet">
*.visualizer.*.packetDropVisualizer.displayPacketDrops = true
*.visualizer.*.packetDropVisualizer.fadeOutTime = 3s
</pre>

<p>
When the simulation is run, the UDP stream starts at around two seconds, and packets start accumulating in the queue of the switch.
When the queue fills up, the switch starts dropping packets. This is illustrated in this animation:
</p>

<video autoplay="" loop="" controls="" onclick="this.paused ? this.play() : this.pause();" src="packetdrop4.mp4" width="628" height="260"></video>

<p>
Here is the queue in the switch's eth1 interface, showing the number of packet drops:
</p>

<img class="screen" src="ethqueue.png">

<p>
This log excerpt shows the packet drop:
</p>

<img class="screen" src="log_queuefull_3.png">

<h2>ARP resolution failed</h2>

<p>
In this example, a host tries to ping a non-existent destination. The configuration for this example is
<var>ArpResolutionFailed</var> in the ini file. Packets will be dropped
because the MAC address of the destination cannot be resolved.
The network for this configuration is the following:
</p>

<img class="screen" src="arpfailednetwork.png">

<p>
It contains only one host, an <var>AdhocHost</var>.
</p>

<p>
The host is configured to ping the IP address 10.0.0.2. It will try to resolve the destination's MAC address with ARP.
Since there are no other hosts, the ARP resolution will fail, and the ping packets will be dropped.
</p>

<p>
The following animation illustrates this:
</p>

<video id="vid" autoplay loop controls onclick="this.paused ? this.play() : this.pause();" src="packetdrop18.mp4" width="366" height="386"></video>

<p>
This excerpt shows this in the log:
</p>

<img class="screen" src="log_arpfailed_2.png">

<h2>MAC retry limit reached</h2>

<p>
In this example, packet drops occur due to two wireless hosts trying to communicate while out of communication range.
The simulation can be run by selecting the <var>MACRetryLimitReached</var> configuration from the ini file. 
The configuration uses the following network:
</p>

<img class="screen" src="maclimitnetwork.png">

<p>
It contains two <var>AdhocHosts</var>, named <var>source</var> and <var>destination</var>. The hosts' communication ranges are set up so they are out of range of each other. The source host is configured to ping the destination host.
The reason for packet drops in this case is that the hosts are not in range, thus they can't reach each other. The <var>source</var> transmits the ping packets,
but it doesn't receive any ACK in reply. The <var>source's</var> MAC module drops the packets after the retry limit has been reached.
</p>

<p>
This is illustrated in the following animation:
</p>

<video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" src="packetdrop14.mp4" width="512" height="385"></video>

<p>
This looks like the following in the logs:
</p>

<img class="screen" src="log_macretrylimit_2.png">

<h2>No route to destination</h2>

<p>
In this example, packets will be dropped due to the lack of static routes. The configuration is <var>NoRouteToDestination</var> in the ini file.
The network is the following:
</p>

<img class="screen" src="noroutenetwork.png">

<p>
It contains two connected <var>StandardHosts</var>.
The <var>IPv4NetworkConfigurator</var> is instructed not to add any static routes, and <var>host1</var> is configured to ping <var>host2</var>.
</p>

<p>
The ping packets can't be routed, thus the IP module drops them. This is illustrated on the following video:
</p>

<video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" src="packetdrop21.mp4" width="416" height="482"></video>

<p>
Here is also a log excerpt illustrating this:
</p>

<img class="screen" src="log_noroute_2.png">

<h2>Interface not connected</h2>

<p>
In this example (<var>InterfaceNotConnected</var> configuration in the ini file), packet drops occur due to a disabled wired connection between the hosts:
</p>

<img class="screen" src="unroutablenetwork.png">

<p>
It contains two <var>StandardHosts</var>, connected with an ethernet cable. The ethernet cable is disabled. Additionally, <var>host1</var> is configured to ping <var>host2</var>.
</p>

<p>
Since the cable between the hosts is disabled, the MAC module is unable to send the packets, and drops them. This is illustrated on the following animation:
</p>

<video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" src="packetdrop22.mp4" width="414" height="477"></video>

<p>
Because there is no connection between the nodes, all packets are dropped.
</p>

<p>
The following log except shows this:
</p>

<img class="screen" src="log_notconnected_2.png">

</body>

</html>