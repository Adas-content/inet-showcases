<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../../../doc/showcases.css">
	<title>Visualizing Network Path Activity</title>
</head>

<body>
	<h1>Visualizing Network Path Activity</h1>

	<p><h2>Goals</h2></p>
    <p>
        In complex networks, it is difficult to trace the packets' network path activity from the source to the destination, because there are a lot of simultaneous communication and we have to pay attention to more than one message at the same time.
        Network topology changes, e.g a router goes offline, also have an effect on the packets' path.
        It would be useful to be able to observe packets that pass through network layer (i.e. carry data from/to higher layers) to follow network path activity between nodes.
    </p>
    <p>
        INET provides a visualizer, that shows between which nodes there is network path activity.
        If network path activity is visualized between two nodes that means the observed packet passes through the network layer of the receiver node.
        By using the network path activity visualization we can identify any certain packet's layer 3 path.
    </p>
    <p>    
        The showcase consists of four simulation models, each demonstrating different features of network path activity visualization.
    </p>	
    <p>
        INET version: <var>3.6</var><br>
        Source files location: <var>inet/showcases/visualization/networkpathactivity</var>
    </p>

    <p><h2>About the Visualizer</h2></p>
    <p>
        In INET, network path activity can be visualized by including a <var>NetworkRouteVisualizer</var> module in the simulation.
        Adding an <var>IntegratedVisualizer</var> module is also an option, because it also contains a <var>NetworkRouteVisualizer</var> module.
        Network path activity visualization is disabled by default, it can be enabled by setting the visualizer's <var>displayRoutes</var> parameter to true.
    </p>
    <p>
        <var>NetworkRouteVisualizer</var> currently observes packets that pass through the network layer (i.e. carry data from/to higher layers), but not those that are internal to the operation of the network layer protocol.
        That is, packets such as ARP, although potentially useful, will not trigger the visualization. Visualizing such packets may be implemented in future INET revisions.
    </p>
    <p>
        The activity between two nodes is represented visually by a polyline arrow which points from the source node to the destination node.
        <var>NetworkRouteVisualizer</var> follows packets throughout their path so that the polyline arrow goes through all nodes which are the part of the network path of packets.
        The arrow appears after the first packet has been received, then gradually fades out unless it is refreshed by further packets.
        Color, fading time and other graphical properties can be changed with parameters of the visualizer.
    </p>
    <p>
        By default, all packets, interfaces and nodes are considered for the visualization.
        This selection can be narrowed with the visualizer's <var>packetFilter</var> and <var>nodeFilter</var> parameters.
    </p>


	<p><h2>Enabling Visualization of Network Paths</h2></p>
    <p>
        The following example shows how to enable the network path visualization with its default settings.
        In the first example, we configure a simulation for a wired network.
		This simulation can be run by choosing the <var>EnablingVisualization</var> configuration from the ini file.
    </p>
    <p>
        The network contains two <var>StandardHosts</var> (<var>source</var> and <var>destination</var>).
        The <var>linkVisualizer's</var> type is <var>NetworkRouteVisualizer</var>.
        In this configuration, the <var>source</var> node pings the <var>destination</var> node.
    </p>
    <img class="screen" src="NetworkPathSimple.png">
    <p>
        The network path activity visualization is enabled by setting the <var>displayRoutes</var> parameter to true:
    </p>
    <div class="snippet">
        *.routeVisualizer.*.displayRoutes = true<br>
    </div>
    <p>
        The following animation shows what happens when we start the simulation:
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=622 height=356 src="EnablingVisualization_v0519.m4v">
    </p>
    <p>
        At the beginning of the video, a red strip appears and moves from <var>source</var> to <var>destination</var>. 
        This strip is the standard OMNeT++ animation for packet transmissions, and has nothing to do with <var>NetworkRouteVisualizer</var>.
        When the packet is received in whole by <var>destination</var> (the red strip disappears), an arrow is added by <var>NetworkRouteVisualizer</var> between the two hosts, indicating network path activity.
        The packet's name is also displayed on the arrow.
        The arrow fades out quickly, because the <var>fadeOutTime</var> parameter of the visualizer is set to a small value.
    </p>
    <p>
        Note, however, that ARP traffic does not activate the visualization, because the ARP packets do not pass through network layer.
    </p>


    <p><h2>Filtering Network Path Activity</h2></p>
    <p>
        In complex networks with many nodes and several protocols in use, it is often useful to be able to filter network traffic, and visualize only the part of the traffic we are interested in. 
    </p>
    <p>
        The following example shows how to set packet filtering in <var>NetworkRouteVisualizer</var>.
		This simulation can be run by choosing the <var>StaticNetworkPaths</var> configuration from the ini file.
    </p>
    <p>
        We use the following network for this showcase:
    </p>
    <img width=800 class="screen" src="NetworkPathComplex_v0519.png">
    <p>
        The network consists of five <var>routers</var> (<var>router0..router4</var>), four <var>etherSwitches</var> (<var>etherSwitch0..etherSwitch3</var>) and eight <var>StandardHosts</var>. 
        There are two source hosts, <var>source1</var> and <var>source2</var>, which ping the two destination hosts (<var>destination1</var> and <var>destination2</var>).
        There is a <var>videoStreamServer</var> node and a <var>videoStreamClient</var> node.
        <var>VideoStreamClient</var> sends one "video streaming request" to <var>videoStreamServer</var>.
        When the request arrives, <var>videoStreamServer</var> starts streaming to <var>videoStreamClient</var>.
    </p>
    <p>
        For this network, the visualizer's type is <var>IntegratedVisualizer</var>.
        Network path visualization is filtered to display only ping traffic.
        We adjust the <var>fadeOutMode</var> and the <var>fadeOutTime</var> parameters, so the network path activity arrow does not fade out completely before the next ping packet arrives.
    </p>
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping*"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 1.4s
    </div>
    <p>
        The following video depicts what happens, when we start the simulation:
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=800 height=638 src="StaticNetworkPaths_v0601.m4v">
    </p>
    <p>
        Each arrow has a different color indicating different paths.
        You can see that although there is both video streaming and ping traffic in the network, <var>NetworkRouteVisualizer</var> only displays the latter, due to the presence of the <var>packetFilter</var> parameter.
    </p>

    
    <p><h2>Visualizing Network Path Activity in a Mobile Ad-Hoc Network</h2></p>
    <p>
        The following simulation shows how visualization can help you to follow dynamically changing network path activity in a wireless environment.
		This simulation can be run by choosing the <var>Mobile</var> configuration from the ini file.
    </p>
    <p>
		The network contains seven mobile nodes which are placed randomly.
        One of the nodes is the <var>source</var> node which pings the <var>destination</var> node.
    </p>
    <img class="screen" src="NetworkPathMobileShowcase_v0606.png">
    <p>
        Nodes are of the type <var>AODVRouter</var>, and are placed randomly on the playground. 
        The communication range of the nodes is chosen so that the network is connected, but nodes can typically only communicate by using multi-hop paths. 
        The nodes will also randomly roam within predefined borders. The routing protocol is AODV.
    </p>
    <p>
        In this simulation, AODV works as follows:<br>
        As long as <var>source</var> has a valid route towards <var>destination</var> or <var>source</var> is not pinging <var>destination</var>, AODV is inactive.
        When a new route is needed towards <var>destination</var>, <var>source</var> starts to flood the network with AODV route request (RREQ) messages.
        RREQ messages propagate through the intermediate nodes until one of them reaches the <var>destination</var> node.
        The route is made available by unicasting AODV route reply (RREP) messages back to the originator of the RREQ messages.
        <br><br>
        (You can see this process in the <var>Data Link Activity</var> showcase, in the <var>Visualizing Data Link Activity in a Mobile Ad-Hoc Network</var> configuration.)
    </p>
    <p>
        We use the following configuration for the visualization: 
    </p>
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping*"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 5s
    </div>
    <p>
        The following video shows what happens when the simulation is run:
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=682 height=734 src="Mobile_v0519.m4v">
    </p>
    <p>
        The communication ranges of <var>source</var> and <var>destination</var> are visualized as blue circles.
    </p>
    <p>
        The video clearly shows the path ping packets are taking between <var>source</var> and <var>destination</var>.
        Ping packets are forwarded to the next hop until they reach the destination.
        The network path activity is visualized after the ping packet has arrived to <var>destination</var> so that we get information about the path changes immediately.
    </p>
    <p>
        When the existing route breaks due to two nodes drifting away (out of the communication range of each other), this manifests as link-level failure (ACK frames do not arrive).
        This condition is detected by AODV and it starts searching for a new route.
        When the new route is found, the ping traffic resumes.
    </p>
    <p>
        We can observe in the video that the route the ping packets take is not always optimal (in terms of hop count).
        The reason is that nodes use an existing route as long as possible, even when a shorter route becomes available as a result of node movement.
        AODV is only activated when the existing route breaks.
    </p>


    <p><h2>TODO: Visualizing Network Path Activity in a Complex Network</h2></p> 
    <p>
        This configuration demonstrates how the visualizer reacts to the routing changes in a complex network.
		This simulation can be run by choosing the <var>ChangingPaths</var> configuration from the ini file.
    </p> 
    <p>
        The network contains four routers (<var>router0..router3</var>) which are placed and connected so as to create redundant paths.
        There are a wired and a wireless source-destination pair and two other hosts which are inactive in this simulation.
		The wired nodes are connected to the routers via <var>etherSwitches</var>, the wireless nodes are connected to the routers via <var>accesPoints</var>.
        <var>WiredSource</var> pings <var>wiredDestination</var> and <var>wirelessSource</var> pings <var>wirelessDestination</var>.
    </p>
    <img width=800 class="screen" src="NetworkPathComplex.png">
    <p>
        We assign IP addresses manually by creating an xml configuration file.
        A lifecycle is created for this configuration to turn off and on the routers at a given time.
        RIP is used for this configuration, so the network paths change dynamically between the source nodes and the destination nodes when the topology changes.
    </p>
    <p>
        In this showcase, we set the <var>packetFilter</var> parameter to display only ping echo traffic.
        We use the following configuration for the visualization: 
    </p>  
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping* and not *reply"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 1.4s
    </div>        
    <p>
        Here is what happens, when the simulation is run:
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=900 height=646 src="ChangingPaths_v0601.m4v">
    </p>
    <p>
        In the beginning of the simulation, ping traffic goes towards <var>router1</var>.
        After five seconds, little ???gears/cogwheels??? appear above <var>router1</var> and after that ???gears/cogwheels??? change to a red cross.
        The red cross indicates <var>router1</var> went offline so that ping echo traffic needs new network path towards the destination nodes.
        As a result of this, the routers update their routing tables based on RIP routing informations and ping traffic goes towards <var>router3</var>.
        While ping traffic goes towards <var>router3</var>, <var>router1</var> turns on again (the red cross disappears).
        After a few seconds the <var>router3</var> goes offline.
        Routing tables are updated based on RIP routing informations and as a result of this, ping echo traffic goes towards <var>router1</var> again.
    </p>


    <p><h2>More Information</h2></p>
    <p>
        This example only demonstrated the key features of network path visualization. For more information, refer to the 
<var>NetworkRouteVisualizer</var> NED documentation.
    </p>
</body>

</html>
