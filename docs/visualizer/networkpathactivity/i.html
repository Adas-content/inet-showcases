<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../../../doc/showcases.css">
	<title>Visualizing Network Path Activity</title>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-240922-3', 'auto');
  ga('send', 'pageview');
</script>
</head>

<body>
	<h1>Visualizing Network Path Activity</h1>

	<p><h2>Goals</h2></p>
    <p>
        In INET simulations, it is often useful to be able to visualize traffic between network nodes.
        INET offers several visualizers for this task, operating at various levels of the network stack.
        In this showcase, we examine <var>NetworkRouteVisualizer</var> that can provide graphical feedback about network layer level traffic.
    <p>    
        The showcase consists of four simulation models, each demonstrating different features of network path activity visualization.
    </p>	
    <p>
        INET version: <var>3.6</var><br>
        Source files location: <var>inet/showcases/visualization/networkpathactivity</var>
    </p>

    <p><h2>About the Visualizer</h2></p>
    <p>
        In INET, network path activity can be visualized by including a <var>NetworkRouteVisualizer</var> module in the simulation.
        Adding an <var>IntegratedVisualizer</var> module is also an option, because it also contains a <var>NetworkRouteVisualizer</var> module.
        Network path activity visualization is disabled by default, it can be enabled by setting the visualizer's <var>displayRoutes</var> parameter to true.
    </p>
    <p>
        <var>NetworkRouteVisualizer</var> currently observes packets that pass through the network layer (i.e. carry data from/to higher layers), but not those that are internal to the operation of the network layer protocol.
        That is, packets such as ARP, although potentially useful, will not trigger the visualization. Visualizing such packets may be implemented in future INET revisions.
    </p>
    <p>
        The activity between two nodes is represented visually by a polyline arrow which points from the source node to the destination node.
        <var>NetworkRouteVisualizer</var> follows packet throughout its path so that the polyline goes through all nodes which are the part of the packet's path.
        The arrow appears after the first packet has been received, then gradually fades out unless it is reinforced by further packets.
        Color, fading time and other graphical properties can be changed with parameters of the visualizer.
    </p>
    <p>
        By default, all packets and nodes are considered for the visualization.
        This selection can be narrowed with the visualizer's <var>packetFilter</var> and <var>nodeFilter</var> parameters.
    </p>


	<p><h2>Enabling Visualization of Network Path Activity</h2></p>
    <p>
        The following example shows how to enable the network path activity visualization with its default settings.
        In the first example, we configure a simulation for a wired network.
		The simulation can be run by choosing the <var>EnablingVisualization</var> configuration from the ini file.
    </p>
    <p>
        The network contains two <var>StandardHosts</var>, a <var>source</var> host and a <var>destination</var> host.
        For this example, the <var>pathVisualizer's</var> type is <var>NetworkRouteVisualizer</var>.
        In this configuration, the <var>source</var> host will be pinging the <var>destination</var> host.
    </p>
    <img class="screen" src="NetworkPathSimple.png">
    <p>
        We enable network path activity visualization by setting the <var>displayRoutes</var> parameter to true.
    </p>
    <div class="snippet">
        *.pathVisualizer.*.displayRoutes = true<br>
    </div>
    <p>
        The following video shows what happens when we start the simulation.
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=622 height=356 src="EnablingVisualization_v0614.m4v">
    </p>
    <p>
        At the beginning of the video, a red strip appears and moves from <var>source</var> to <var>destination</var>. 
        This strip is the standard OMNeT++ animation for packet transmissions, and has nothing to do with <var>NetworkRouteVisualizer</var>.
        When the packet is received in whole by <var>destination</var> (the red strip disappears), an arrow is added by <var>NetworkRouteVisualizer</var> between the two hosts, indicating network path activity.
        The packet's name is also displayed on the arrow.
        The arrow fades out quickly, because the <var>fadeOutTime</var> parameter of the visualizer is set to a small value.
    </p>
    <p>
        Note, however, that ARP traffic does not activate the visualization, because the ARP packets do not pass through the network layer.
    </p>


    <p><h2>Filtering Network Path Activity</h2></p>
    <p>
        In complex networks where many nodes and several protocols are used, it is often useful to be able to filter network traffic, and visualize only the part of the traffic we are interested in. 
    </p>
    <p>
        The following example shows how to set packet filtering.
		This simulation can be run by choosing the <var>StaticNetworkPaths</var> configuration from the ini file.
    </p>
    <p>
        We use the following network for this showcase:
    </p>
    <img width=800 class="screen" src="NetworkPathComplex_v0703.png">
    <p>
        The network consists of five <var>routers</var> (<var>router0..router4</var>), four <var>etherSwitches</var> (<var>etherSwitch0..etherSwitch3</var>) and eight <var>StandardHosts</var>. 
        There are two source hosts, <var>source1</var> and <var>source2</var>, which will be pinging the two destination hosts (<var>destination1</var> and <var>destination2</var>).
        The <var>videoServer</var> node streams a video to the <var>videoClient</var> node.
    </p>
    <p>
        For this network, the visualizer's type is <var>IntegratedVisualizer</var>.
        Network path visualization is filtered to display only ping traffic.
        The video stream packets are not visualized by network path activity visualizer.
        We adjust the <var>fadeOutMode</var> and the <var>fadeOutTime</var> parameters, so the network path activity arrow does not fade out completely before the next ping packet arrives.
    </p>
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping*"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 1.4s
    </div>
    <p>
        The following video shows what happens, when the simulation is run.
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=800 height=638 src="StaticNetworkPaths_v0703.m4v">
    </p>
    <p>
        Each arrow has a different color indicating different paths.
        You can see that although there is both video stream and ping traffic in the network, <var>NetworkRouteVisualizer</var> only displays the latter, due to the presence of the <var>packetFilter</var> parameter.
    </p>

    
    <p><h2>Visualizing Network Path Activity in a Mobile Ad-Hoc Network</h2></p>
    <p>
        The following example shows how visualization can help you to follow dynamically changing network path activity in a wireless environment.
		A simulation is created for this example, that can be run by choosing the <var>Mobile</var> configuration from the ini file.
    </p>
    <p>
        Nodes are of the type <var>AODVRouter</var>, and are placed randomly on the playground. 
        One of the nodes is the <var>source</var> node which will be pinging the <var>destination</var> node.
        The communication range of the nodes is chosen so that the network is connected, but nodes can typically only communicate by using multi-hop paths. 
        The nodes will also randomly roam within predefined borders.
    </p>
    <img class="screen" src="NetworkPathMobileShowcase_v0606.png">
    <p>
        The routing protocol is AODV.
        It works as follows:<br>
        As long as <var>source</var> has a valid route towards <var>destination</var> or <var>source</var> does not send any packets towards <var>destination</var>, AODV is inactive.
        When a new route is needed towards <var>destination</var>, <var>source</var> starts to flood the network with AODV route request (RREQ) messages.
        RREQ messages propagate through the intermediate nodes until one of them reaches the <var>destination</var> node.
        The route is made available by unicasting AODV route reply (RREP) messages back to the originator of the RREQ messages.
        <br><br>
        (You can watch a video about this process in the <var>Data Link Activity</var> showcase, in the <var>Visualizing Data Link Activity in a Mobile Ad-Hoc Network</var> configuration.)
    </p>
    <p>
        We use the following configuration for the visualization.
    </p>
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping*"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 5s
    </div>
    <p>
        The following video shows what happens when the simulation is run.
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=682 height=734 src="Mobile_v0614.m4v">
    </p>
    <p>
        The communication ranges of <var>source</var> and <var>destination</var> are visualized as blue circles.
    </p>
    <p>
        The video clearly shows the path ping packets are taking between <var>source</var> and <var>destination</var>.
        Ping packets are forwarded to the next hop until they reach the destination.
        The network path activity is visualized after the ping packet has arrived to <var>destination</var> so that we get information about the path changes immediately.
    </p>
    <p>
        When the existing route breaks due to two nodes drifting away (out of the communication range of each other), this manifests as link-level failure (ACK frames do not arrive).
        This condition is detected by AODV and it starts searching for a new route.
        When the new route is found, the ping traffic resumes.
    </p>
    <p>
        We can observe in the video that the route the ping packets take is not always optimal (in terms of hop count).
        The reason is that nodes use an existing route as long as possible, even when a shorter route becomes available as a result of node movement.
        AODV is only activated when the existing route breaks.
    </p>


    <p><h2>Displaying Network Path Activity in a Complex Network</h2></p> 
    <p>
        This configuration demonstrates how the visualizer reacts to the routing changes in a complex network.
        A simulation is created for this example.
		The simulation can be run by choosing the <var>ChangingPaths</var> configuration from the ini file.
    </p> 
    <p>
        The network contains four routers (<var>router0..router3</var>) which are placed and connected so as to create redundant paths.
        There are a wired and a wireless source-destination pair and two other hosts which are inactive in this simulation.
		The wired nodes are connected to the routers via switches (<var>etherSwitch0</var> and <var>etherSwitch1</var>), the wireless nodes are connected to the routers via acces points (<var>accessPoint0</var> and <var>accessPoint1</var>).
    </p>
    <img width=800 class="screen" src="NetworkPathChanging.png">
    <p>
        We assign IP addresses manually by creating an xml configuration file.
        A lifecycle is created for this configuration to turn off and on the routers at a certain time.
        RIP routing protocol is used in this example, so the network routes will change dynamically between the source nodes and the destination nodes.
        During the simulation, <var>wiredSource</var> will be pinging <var>wiredDestination</var> and <var>wirelessSource</var> will be pinging <var>wirelessDestination</var>.
    </p>
    <p>
        In this showcase, we set the <var>packetFilter</var> parameter to display only ICMP echo traffic.
        We use the following configuration for the visualization.
    </p>  
    <div class="snippet">
        *.visualizer.*.networkRouteVisualizer.displayRoutes = true<br>
        *.visualizer.*.networkRouteVisualizer.packetFilter = "ping* and not *reply"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutMode = "simulationTime"<br>
        *.visualizer.*.networkRouteVisualizer.fadeOutTime = 1.4s
    </div>        
    <p>
        Here is what happens, when the simulation is run.
    </p>
    <p align="center">        
        <video autoplay loop controls onclick="this.paused ? this.play() : this.pause();" width=900 height=646 src="ChangingPaths_v0614.m4v">
    </p>
    <p>
        In the beginning of the video, ping traffic goes towards <var>router1</var>.
        After five seconds, small cogwheels appear above <var>router1</var> and after that cogwheels change to a red cross.
        The red cross indicates <var>router1</var> went offline so that ping traffic needs new network path towards the destination nodes.
        As a result of this, the routers update their routing tables based on RIP routing informations, and ping traffic goes towards <var>router3</var>.
        While ping traffic goes towards <var>router3</var>, <var>router1</var> turns on again (the red cross disappears).
        After a few seconds the <var>router3</var> goes offline.
        Routing tables are updated based on RIP routing informations and as a result of this, ping traffic goes towards <var>router1</var> again.
        At the end of the video, <var>router3</var> turns on, but it does not have an effect on the network routes.
    </p>


    <p><h2>More Information</h2></p>
    <p>
        This example only demonstrated the key features of network path visualization.
        For more information, refer to the <var>NetworkRouteVisualizer</var> NED documentation.
    </p>
</body>

</html>
